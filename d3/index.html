<!doctype html>
<html class="ocks-org do-not-copy">
  <meta charset="utf-8" />
  <title>Path Transitions</title>
  <link href="style.css" rel="stylesheet" />
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="script.js"></script>
  <script>
    // --- Chart1 --------------------------
    function Chart1() {
      var transition = d3.select({}).transition().duration(duration).ease('linear')

      function tick(path, line, data) {
        function each() {
          // push a new data point onto the back
          data.push(random())
          // pop the old data point off the front
          data.shift()
          // transition the line
          path.transition().attr('d', line)
        }
        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data))
      }

      chart('#chart1', [0, n - 1], [-1, 1], 'linear', tick)
    }

    // --- Chart2 --------------------------
    function Chart2() {
      var transition = d3.select({}).transition().duration(duration).ease('linear')

      function tick(path, line, data, x) {
        function each() {
          // push a new data point onto the back
          data.push(random())
          // redraw the line, and then slide it to the left
          path
            .attr('d', line)
            .attr('transform', null)
            .transition()
            .attr('transform', 'translate(' + x(-1) + ')')
          // pop the old data point off the front
          data.shift()
        }
        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data, x))
      }

      chart('#chart2', [0, n - 1], [-1, 1], 'linear', tick)
    }

    // --- Chart3 --------------------------
    function Chart3() {
      var transition = d3.select({}).transition().duration(duration).ease('linear')

      function tick(path, line, data, x) {
        function each() {
          // push a new data point onto the back
          data.push(random())
          // redraw the line, and then slide it to the left, and repeat indefinitely
          path
            .attr('d', line)
            .attr('transform', null)
            .transition()
            .attr('transform', 'translate(' + x(0) + ')')
          // pop the old data point off the front
          data.shift()
        }
        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data, x))
      }

      chart('#chart3', [1, n - 2], [-1, 1], 'basis', tick)
    }

    // --- Chart4 --------------------------
    function Chart4() {
      var now = new Date(Date.now() - duration)
      var data = d3.range(n).map(() => {
        return 0
      })

      var x = d3.time
        .scale()
        .domain([now - (n - 2) * duration, now - duration])
        .range([0, width])
      var y = d3.scale.linear().range([height, 0])

      var line = d3.svg
        .line()
        .interpolate('basis')
        .x((d, i) => x(now - (n - 1 - i) * duration))
        .y((d, i) => y(d))

      var svg = createSvg('#chart4')

      svg.append('g').attr('class', 'y axis').call(d3.svg.axis().scale(y).ticks(5).orient('left'))
      
      var axis = svg
        .append('g')
        .attr('class', 'x axis')
        .attr('transform', 'translate(0,' + height + ')')
        .call((x.axis = d3.svg.axis().scale(x).orient('bottom')))
      var path = svg.append('g').attr('clip-path', 'url(#clip)').append('path').datum(data).attr('class', 'line')

      var transition = d3.select({}).transition().duration(duration).ease('linear')

      function tick() {
        function each() {
          data.push(random() + 0.4)

          now = new Date()
          x.domain([now - (n - 2) * duration, now - duration])
          y.domain([0, d3.max(data)])
          svg.select('.line').attr('d', line).attr('transform', null)
          axis.call(x.axis)
          path.transition().attr('transform', 'translate(' + x(now - (n - 1) * duration) + ')')

          data.shift()
        }
        transition = transition.each(each).transition().each('start', tick)
      }

      tick()
    }
  </script>
  <header>
    <aside>January 19, 2012</aside>
  </header>
  <h1>Path Transitions</h1>
  <div id="container">
    <div>
      Peer Connection
      <pre id="peer-connection"></pre>
    </div>
    <div id="chart-container">
      <div id="chart1">
        Chart1
        <script>
          Chart1()
        </script>
      </div>
      <div id="chart2">
        Chart2
        <script>
          Chart2()
        </script>
      </div>
      <div id="chart3">
        Chart3
        <script>
          Chart3()
        </script>
      </div>
      <div id="chart4">
        Chart4
        <script>
          Chart4()
        </script>
      </div>
    </div>
  </div>
</html>
