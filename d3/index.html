<!doctype html>
<html class="ocks-org do-not-copy">
  <meta charset="utf-8" />
  <title>Path Transitions</title>
  <style>
    body {
      margin: 1em auto 4em auto;
      position: relative;
      width: 960px;
    }

    svg {
      font: 10px sans-serif;
    }

    .axis path,
    .axis line {
      fill: none;
      stroke: #000;
      shape-rendering: crispEdges;
    }

    .x.axis line {
      shape-rendering: auto;
    }

    .line {
      fill: none;
      stroke: #000;
      stroke-width: 1.5px;
    }

    #container {
      display: flex;
      gap: 10px;
      padding: 10px;
    }

    #container > div {
      border: 1px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
    }

    #container > div:first-child {
      flex: 1;
      min-width: 200px;
    }

    #container > div:last-child {
      flex: 3;
    }

    #chart-container {
      display: flex;
      flex-direction: column;
    }

    div > p {
      border: 1px solid #ccc;
      padding: 10px;
      box-sizing: border-box;
    }
  </style>
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script>
    var n = 60
    var random = d3.random.normal(0, 0.2)

    function chart(id, domain, interpolation, tick) {
      var data = d3.range(n).map(random)
      var margin = { top: 6, right: 10, bottom: 6, left: 25 }
      var width = 720 - margin.right
      var height = 120 - margin.top - margin.bottom
      var x = d3.scale.linear().domain(domain).range([0, width])
      var y = d3.scale.linear().domain([-1, 1]).range([height, 0])
      var line = d3.svg
        .line()
        .interpolate(interpolation)
        .x((d, i) => {
          return x(i)
        })
        .y((d, i) => {
          return y(d)
        })
      var svg = d3
        .select(id)
        .append('p')
        .append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        // .style('margin-left', -margin.left + 'px')
        .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
      svg.append('defs').append('clipPath').attr('id', 'clip').append('rect').attr('width', width).attr('height', height)
      svg.append('g').attr('class', 'y axis').call(d3.svg.axis().scale(y).ticks(5).orient('left'))
      var path = svg.append('g').attr('clip-path', 'url(#clip)').append('path').datum(data).attr('class', 'line').attr('d', line)
      tick(path, line, data, x)
    }

    // --- Chart1 --------------------------
    function Chart1() {
      var transition = d3.select({}).transition().duration(750).ease('linear')

      function tick(path, line, data) {
        function each() {
          // push a new data point onto the back
          data.push(random())
          // pop the old data point off the front
          data.shift()
          // transition the line
          path.transition().attr('d', line)
        }

        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data))
      }
      chart('#chart1', [0, n - 1], 'linear', tick)
    }

    // --- Chart2 --------------------------
    function Chart2() {
      var transition = d3.select({}).transition().duration(750).ease('linear')

      function tick(path, line, data, x) {
        function each() {
          // push a new data point onto the back
          data.push(random())
          // redraw the line, and then slide it to the left
          path
            .attr('d', line)
            .attr('transform', null)
            .transition()
            .attr('transform', 'translate(' + x(-1) + ')')
          // pop the old data point off the front
          data.shift()
        }

        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data, x))
      }
      chart('#chart2', [0, n - 1], 'linear', tick)
    }

    // --- Chart3 --------------------------
    function Chart3() {
      var transition = d3.select({}).transition().duration(750).ease('linear')

      function tick(path, line, data, x) {
        function each() {
          // push a new data point onto the back
          data.push(random())
          // redraw the line, and then slide it to the left, and repeat indefinitely
          path
            .attr('d', line)
            .attr('transform', null)
            .transition()
            .attr('transform', 'translate(' + x(0) + ')')
          // pop the old data point off the front
          data.shift()
        }
        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data, x))
      }
      chart('#chart3', [1, n - 2], 'basis', tick)
    }

    // --- Chart4 --------------------------
    function Chart4() {
      var n = 60
      var duration = 750
      var now = new Date(Date.now() - duration)
      var count = 0
      var data = d3.range(n).map(() => {
        return 0
      })
      var margin = { top: 6, right: 0, bottom: 20, left: 20 }
      var width = 720 - margin.right
      var height = 120 - margin.top - margin.bottom
      var x = d3.time
        .scale()
        .domain([now - (n - 2) * duration, now - duration])
        .range([0, width])
      var y = d3.scale.linear().range([height, 0])
      var line = d3.svg
        .line()
        .interpolate('basis')
        .x((d, i) => {
          return x(now - (n - 1 - i) * duration)
        })
        .y((d, i) => {
          return y(d)
        })
      var svg = d3
        .select('#chart4')
        .append('p')
        .append('svg')
        .attr('width', width + margin.left + margin.right)
        .attr('height', height + margin.top + margin.bottom)
        /* .style('margin-left', -margin.left + 'px') */
        .append('g')
        .attr('transform', 'translate(' + margin.left + ',' + margin.top + ')')
      svg.append('defs').append('clipPath').attr('id', 'clip').append('rect').attr('width', width).attr('height', height)
      var axis = svg
        .append('g')
        .attr('class', 'x axis')
        .attr('transform', 'translate(0,' + height + ')')
        .call((x.axis = d3.svg.axis().scale(x).orient('bottom')))
      var path = svg.append('g').attr('clip-path', 'url(#clip)').append('path').datum(data).attr('class', 'line')
      var transition = d3.select({}).transition().duration(750).ease('linear')
      d3.select(window).on('scroll', () => {
        ++count
      })

      function tick() {
        function each() {
          // update the domains
          now = new Date()
          x.domain([now - (n - 2) * duration, now - duration])
          y.domain([0, d3.max(data)])
          // push the accumulated count onto the back, and reset the count
          data.push(Math.min(30, count))
          count = 0
          // redraw the line
          svg.select('.line').attr('d', line).attr('transform', null)
          // slide the x-axis left
          axis.call(x.axis)
          // slide the line left
          path.transition().attr('transform', 'translate(' + x(now - (n - 1) * duration) + ')')
          // pop the old data point off the front
          data.shift()
        }
        transition = transition.each(each).transition().each('start', tick)
      }

      tick()
    }
  </script>
  <header>
    <aside>January 19, 2012</aside>
  </header>
  <h1>Path Transitions</h1>
  <div id="container">
    <div>
      Peer Connection
      <pre id="peer-connection"></pre>
    </div>
    <div id="chart-container">
      <div id="chart1">
        Chart1
        <script>
          Chart1()
        </script>
      </div>
      <div id="chart2">
        Chart2
        <script>
          Chart2()
        </script>
      </div>
      <div id="chart3">
        Chart3
        <script>
          Chart3()
        </script>
      </div>
      <div id="chart4">
        Chart4
        <script>
          Chart4()
        </script>
      </div>
    </div>
  </div>
</html>
