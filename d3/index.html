<!doctype html>
<html class="ocks-org do-not-copy">
  <meta charset="utf-8" />
  <title>Path Transitions</title>
  <link href="style.css" rel="stylesheet" />
  <script src="//d3js.org/d3.v3.min.js" charset="utf-8"></script>
  <script src="script.js"></script>
  <script>
    // --- Chart1 --------------------------
    function Chart1() {
      var transition = d3.select({}).transition().duration(duration).ease('linear')

      function tick(path, line, data, lastIndex, x, timeseries, axisX, y, axisY, svg) {
        function each() {
          // push a new data point onto the back
          data.push(random())

          now = new Date()
          timeseries.domain([now - lastIndex * duration, now - duration])
          axisX.call(timeseries.axis)

          y.domain([d3.min(data), d3.max(data)])
          axisY.call(y.axis)

          // redraw the line, and then slide it to the left
          path
            .attr('d', line)
            .attr('transform', null)
            .transition()
            .attr('transform', 'translate(' + x(-1) + ')')

          // pop the old data point off the front
          data.shift()
        }
        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data, lastIndex, x, timeseries, axisX, y, axisY, svg))
      }

      lineChart('#chart1', [0, n - 1], 'linear', tick)
    }

    // --- Chart2 --------------------------
    function Chart2() {
      var transition = d3.select({}).transition().duration(duration).ease('linear')

      function tick(path, line, data, lastIndex, x, timeseries, axisX, y, axisY, svg) {
        function each() {
          // push a new data point onto the back
          data.push(random())

          now = new Date()
          timeseries.domain([now - lastIndex * duration, now - duration])
          axisX.call(timeseries.axis)

          y.domain([d3.min(data), d3.max(data)])
          axisY.call(y.axis)

          // redraw the line, and then slide it to the left, and repeat indefinitely
          path
            .attr('d', line)
            .attr('transform', null)
            .transition()
            .attr('transform', 'translate(' + x(0) + ')')

          // pop the old data point off the front
          data.shift()
        }
        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(path, line, data, lastIndex, x, timeseries, axisX, y, axisY, svg))
      }

      lineChart('#chart2', [1, n - 2], 'basis', tick)
    }

    // --- Chart3 --------------------------
    function Chart3() {
      var transition = d3.select({}).transition().duration(duration).ease('linear')

      function tick(bars, data, lastIndex, x, timeseries, axis, y, svg) {
        function each() {
          data.push(random())

          x.domain([x.domain()[0] + 1, x.domain()[1] + 1])

          now = new Date()
          timeseries.domain([now - lastIndex * duration, now - duration])
          axis.call(timeseries.axis)

          y.domain([d3.min(data), d3.max(data)])
          svg
            .select('.y.axis')
            .transition()
            .duration(duration)
            .call((y.axis = d3.svg.axis().scale(y).ticks(5).orient('left')))

          bars = bars.data(data)
          bars
            .enter()
            .append('rect')
            .attr('class', 'bar')
            .attr('x', (d, i) => x(i))
            .attr('y', (d) => y(d))
            .attr('width', width / n - 1)
            .attr('height', (d) => height - y(d))
            .attr('fill', 'steelblue')
          bars
            .transition()
            .duration(duration)
            .attr('x', (d, i) => x(i))
        }

        transition = transition
          .each(each)
          .transition()
          .each('start', () => tick(bars, data, lastIndex, x, timeseries, axis, y, svg))
      }

      barChart('#chart3', [0, n - 1], tick)
    }
  </script>
  <header>
    <aside>January 19, 2012</aside>
  </header>
  <h1>Path Transitions</h1>
  <div id="container">
    <div>
      Peer Connection
      <pre id="peer-connection"></pre>
    </div>
    <div id="chart-container">
      <div id="chart1">
        Chart1
        <script>
          Chart1()
        </script>
      </div>
      <div id="chart2">
        Chart2
        <script>
          Chart2()
        </script>
      </div>
      <div id="chart3">
        Chart3
        <script>
          Chart3()
        </script>
      </div>
    </div>
  </div>
</html>
